<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Sensores - Connection-4</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link href="assets/css/style.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <h2 class="my-4">Teste de Funcionamento dos Sensores Fixos</h2>
                
                <div class="alert alert-info">
                    <h5><i class="bi bi-info-circle"></i> Como funcionam os sensores:</h5>
                    <ul class="mb-0">
                        <li><strong>Sensores Fixos:</strong> Dispositivos instalados permanentemente nas zonas de risco</li>
                        <li><strong>SENSOR_GUINDASTES:</strong> Sensor fixo na Zona de Guindastes</li>
                        <li><strong>SENSOR_SOLDAS:</strong> Sensor fixo na Zona de Soldas</li>
                        <li><strong>Proteção:</strong> Sensores não podem ser movidos por simulações ou controles</li>
                        <li><strong>Detecção:</strong> Colaboradores próximos (≤10m) aparecem com indicador roxo</li>
                    </ul>
                </div>
                
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>Controles de Teste</h5>
                            </div>
                            <div class="card-body">
                                <button id="btn-clear-data" class="btn btn-warning mb-2">Limpar Dados Locais</button>
                                <button id="btn-init-data" class="btn btn-primary mb-2">Inicializar Dados de Teste</button>
                                <button id="btn-show-data" class="btn btn-info mb-2">Mostrar Dados</button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>Dados Atuais</h5>
                            </div>
                            <div class="card-body" id="data-display">
                                Clique em "Mostrar Dados" para ver o estado atual
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h5>Teste do Monitoramento</h5>
                    </div>
                    <div class="card-body">
                        <button id="btn-test-monitoring" class="btn btn-success">Ir para Monitoramento</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/models/devicesModel.js"></script>
    <script src="js/models/peopleModel.js"></script>
    <script src="js/models/mapModel.js"></script>
    <script src="js/controllers/devicesController.js"></script>
    <script src="js/controllers/peopleController.js"></script>
    <script src="js/controllers/mapController.js"></script>

    <script>
        document.getElementById('btn-clear-data').addEventListener('click', () => {
            localStorage.clear();
            alert('Dados locais limpos!');
            document.getElementById('data-display').innerHTML = 'Dados limpos. Clique em "Inicializar Dados" para criar novos dados.';
        });

        document.getElementById('btn-init-data').addEventListener('click', async () => {
            try {
                // Inicializar controllers
                DevicesController.init();
                PeopleController.init();
                
                // Criar dispositivos de teste
                DevicesModel.add({id:'D100', type:'worker', active:true});
                DevicesModel.add({id:'D200', type:'worker', active:true});
                DevicesModel.add({id:'SENSOR_GUINDASTES', type:'sensor', active:true});
                DevicesModel.add({id:'SENSOR_SOLDAS', type:'sensor', active:true});
                
                // Criar pessoas de teste
                PeopleModel.add({name:'Carlos Silva', role:'Operador', deviceId:'D100'});
                PeopleModel.add({name:'Ana Pereira', role:'Supervisor', deviceId:'D200'});
                
                // Definir posições dos sensores FIXOS nas zonas de risco
                MapModel.setDevicePositionLocal('D100', 0.25, 0.35);
                MapModel.setDevicePositionLocal('D200', 0.7, 0.2);
                
                // Sensores fixos posicionados no CENTRO das áreas de perigo (coordenadas atualizadas)
                MapModel.setDevicePositionLocal('SENSOR_GUINDASTES', 0.50, 0.11); // Centro da Zona de Guindastes 
                MapModel.setDevicePositionLocal('SENSOR_SOLDAS', 0.44, 0.39);     // Centro da Zona de Soldas
                
                alert('Dados de teste inicializados com sucesso!');
                document.getElementById('btn-show-data').click();
            } catch (error) {
                alert('Erro ao inicializar dados: ' + error.message);
            }
        });

        document.getElementById('btn-show-data').addEventListener('click', () => {
            const devices = DevicesModel.all();
            const people = PeopleModel.all();
            const positions = MapModel.getDevicePositions();
            
            const html = `
                <h6>Dispositivos (${devices.length}):</h6>
                <ul class="list-group list-group-flush mb-3">
                    ${devices.map(d => `<li class="list-group-item">${d.id} - ${d.type} (${d.active ? 'Ativo' : 'Inativo'})</li>`).join('')}
                </ul>
                
                <h6>Pessoas (${people.length}):</h6>
                <ul class="list-group list-group-flush mb-3">
                    ${people.map(p => `<li class="list-group-item">${p.name} - ${p.role} (Device: ${p.deviceId || 'Nenhum'})</li>`).join('')}
                </ul>
                
                <h6>Posições:</h6>
                <ul class="list-group list-group-flush">
                    ${Object.entries(positions).map(([id, pos]) => `<li class="list-group-item">${id}: (${pos.x}, ${pos.y})</li>`).join('')}
                </ul>
            `;
            
            document.getElementById('data-display').innerHTML = html;
        });

        document.getElementById('btn-test-monitoring').addEventListener('click', () => {
            window.location.href = 'index.html#monitoring';
        });
    </script>
</body>
</html>